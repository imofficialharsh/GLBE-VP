{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<style>
    @keyframes blob-move {
        0% {
            transform: translate(0px, 0px) scale(1);
        }

        33% {
            transform: translate(30px, -50px) scale(1.1);
        }

        66% {
            transform: translate(-20px, 20px) scale(0.9);
        }

        100% {
            transform: translate(0px, 0px) scale(1);
        }
    }

    .animate-blob {
        animation: blob-move 8s infinite ease-in-out;
    }
</style>

<div class="relative min-h-screen -m-4 md:-m-6 p-4 md:p-6 overflow-hidden">

    <div class="absolute top-0 left-0 w-full h-full">
        <div
            class="absolute top-0 -left-16 w-72 h-72 bg-purple-200 rounded-full mix-blend-multiply filter blur-2xl opacity-60 animate-blob">
        </div>
        <div class="absolute top-0 -right-16 w-72 h-72 bg-sky-200 rounded-full mix-blend-multiply filter blur-2xl opacity-60 animate-blob"
            style="animation-delay: 2s;">
        </div>
        <div class="absolute -bottom-16 left-20 w-72 h-72 bg-indigo-200 rounded-full mix-blend-multiply filter blur-2xl opacity-60 animate-blob"
            style="animation-delay: 4s;">
        </div>
    </div>

    <div class="relative max-w-7xl mx-auto">

        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
            <h1 class="text-3xl font-bold text-slate-800">Welcome, {{ user.name if user else 'Vendor' }}!</h1>
            <a href="/upload-invoices"
                class="mt-4 sm:mt-0 inline-flex items-center gap-2 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow-sm hover:bg-indigo-700 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                        clip-rule="evenodd" />
                </svg>
                Upload Invoice
            </a>
        </div>

        <div class="bg-amber-50/70 border-l-4 border-amber-400 text-amber-800 p-4 mb-8 rounded-r-lg flex items-start gap-4 backdrop-blur-sm"
            role="alert">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 flex-shrink-0" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <div>
                <p class="font-bold">A quick reminder</p>
                <p class="text-sm">Please ensure you select the correct form for vendor registration: <strong>'Material
                        form'</strong> for suppliers vs. <strong>'Work form'</strong> for contractors.</p>
            </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 mb-8">
            <div class="bg-white/70 backdrop-blur-sm p-5 rounded-xl border border-slate-200">
                <h4 class="text-sm font-medium text-slate-500 mb-1">Total Uploaded</h4>
                <p class="text-3xl font-bold text-slate-800">{{ total_invoices_count }}</p>
            </div>
            <div class="bg-white/70 backdrop-blur-sm p-5 rounded-xl border border-slate-200">
                <h4 class="text-sm font-medium text-slate-500 mb-1">In Review</h4>
                <p class="text-3xl font-bold text-amber-500">{{ in_review_invoices_count }}</p>
            </div>
            <div class="bg-white/70 backdrop-blur-sm p-5 rounded-xl border border-slate-200">
                <h4 class="text-sm font-medium text-slate-500 mb-1">Approved</h4>
                <p class="text-3xl font-bold text-blue-600">{{ approved_invoices_count }}</p>
            </div>
            <div class="bg-white/70 backdrop-blur-sm p-5 rounded-xl border border-slate-200">
                <h4 class="text-sm font-medium text-slate-500 mb-1">Paid</h4>
                <p class="text-3xl font-bold text-emerald-600">{{ paid_invoices_count }}</p>
            </div>
            <div class="bg-white/70 backdrop-blur-sm p-5 rounded-xl border border-slate-200">
                <h4 class="text-sm font-medium text-slate-500 mb-1">Rejected</h4>
                <p class="text-3xl font-bold text-rose-600">{{ rejected_invoices_count }}</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-8">
                <div class="bg-white/70 backdrop-blur-sm p-6 rounded-xl border border-slate-200">
                    <h3 class="text-lg font-semibold text-slate-800 mb-2">Financial Overview</h3>
                    <p class="text-sm text-slate-500 mb-6">Summary of your total business value and recent transactions.
                    </p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-emerald-50/80 p-6 rounded-lg border border-emerald-200 md:col-span-1">
                            <h4 class="text-sm font-medium text-emerald-700 mb-1">Total Business (Paid)</h4>
                            <p class="text-3xl font-bold text-emerald-600">₹{{ "{:,.2f}".format(total_business_value) }}
                            </p>
                        </div>
                        <div class="md:col-span-2">
                            <h4 class="font-semibold text-slate-600 mb-4">Recent Payments</h4>
                            {% if recent_payments %}
                            <ul class="divide-y divide-slate-200">
                                {% for payment in recent_payments %}
                                <li class="py-3 flex justify-between items-center">
                                    <div>
                                        <p class="font-medium text-slate-800">{{ payment.invoice_number }}</p>
                                        <p class="text-sm text-slate-500">Paid on: {{
                                            payment.payment_date.strftime('%d-%b-%Y') if payment.payment_date else 'N/A'
                                            }}</p>
                                    </div>
                                    <p class="font-semibold text-emerald-600">₹{{
                                        "{:,.2f}".format(payment.invoice_amount) }}</p>
                                </li>
                                {% endfor %}
                            </ul>
                            {% else %}
                            <div class="text-center py-8 border-2 border-dashed border-slate-200 rounded-lg">
                                <p class="text-slate-500">No recent payments to display.</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="bg-white/70 backdrop-blur-sm p-6 rounded-xl border border-slate-200">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-slate-800">Recent Activity</h3>
                            <p class="text-sm text-slate-500 mt-1">A timeline of recent invoice events.</p>
                        </div>
                        <a href="/all-invoices"
                            class="text-sm font-medium text-indigo-600 hover:text-indigo-800 mt-2 sm:mt-0">View
                            All
                            Invoices &rarr;</a>
                    </div>

                    <div class="mt-4">
                        {% if recent_activities %}
                        <ul class="space-y-4">
                            {% for activity in recent_activities %}
                            <li class="flex items-start gap-4 p-3 rounded-lg hover:bg-slate-50/80">
                                <div class="flex-shrink-0">
                                    {% if activity.type == 'upload' %}
                                    <span
                                        class="flex items-center justify-center h-10 w-10 rounded-full bg-indigo-100 text-indigo-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20"
                                            fill="currentColor">
                                            <path
                                                d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H5.5z" />
                                            <path d="M9 13.5V9m0 0l-1 1m1-1l1 1" />
                                        </svg>
                                    </span>
                                    {% elif activity.type == 'approved' %}
                                    <span
                                        class="flex items-center justify-center h-10 w-10 rounded-full bg-blue-100 text-blue-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </span>
                                    {% elif activity.type == 'paid' %}
                                    <span
                                        class="flex items-center justify-center h-10 w-10 rounded-full bg-emerald-100 text-emerald-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                                        </svg>
                                    </span>
                                    {% elif activity.type == 'rejected' %}
                                    <span
                                        class="flex items-center justify-center h-10 w-10 rounded-full bg-rose-100 text-rose-600">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </span>
                                    {% endif %}
                                </div>

                                <div class="flex-grow">
                                    <p class="text-sm font-medium text-slate-800">
                                        {% if activity.type == 'upload' %}
                                        You uploaded invoice <a href="/track-invoices/{{ activity.invoice_id }}"
                                            class="font-bold text-indigo-600 hover:underline">{{ activity.invoice_number
                                            }}</a>.
                                        {% elif activity.type == 'approved' %}
                                        Invoice <a href="/track-invoices/{{ activity.invoice_id }}"
                                            class="font-bold text-blue-600 hover:underline">{{ activity.invoice_number
                                            }}</a> was approved.
                                        {% elif activity.type == 'paid' %}
                                        Payment for invoice <a href="/track-invoices/{{ activity.invoice_id }}"
                                            class="font-bold text-emerald-600 hover:underline">{{
                                            activity.invoice_number }}</a> has been processed.
                                        {% elif activity.type == 'rejected' %}
                                        Invoice <a href="/track-invoices/{{ activity.invoice_id }}"
                                            class="font-bold text-rose-600 hover:underline">{{ activity.invoice_number
                                            }}</a> was rejected.
                                        {% endif %}
                                    </p>
                                    <p class="text-xs text-slate-500 mt-1">
                                        {{ activity.timestamp.strftime('%d-%b-%Y %I:%M %p') }}
                                    </p>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <div class="text-center py-8 border-2 border-dashed border-slate-200 rounded-lg">
                            <p class="text-slate-500">No recent activity to display.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="lg:col-span-1 space-y-8">
                <div class="bg-white/70 backdrop-blur-sm p-6 rounded-xl border border-slate-200">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">Profile Status</h3>
                    <div class="flex items-center gap-3">
                        {% if profile_status == 'Verified' %}
                        <span class="flex h-3 w-3 relative">
                            <span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"></span>
                        </span>
                        <p class="text-lg font-bold text-emerald-600">Verified</p>
                        {% elif profile_status == 'Under Review' %}
                        <p class="text-lg font-bold text-blue-500">Under Review</p>
                        {% elif profile_status == 'Rejected' %}
                        <p class="text-lg font-bold text-rose-600">Rejected</p>
                        {% else %}
                        <p class="text-lg font-bold text-amber-500">Incomplete</p>
                        {% endif %}
                    </div>
                    <a href="/your-profile"
                        class="text-sm font-medium text-indigo-600 hover:text-indigo-800 mt-4 inline-block">View/Update
                        Profile &rarr;</a>
                </div>

                <div class="bg-white/70 backdrop-blur-sm p-6 rounded-xl border border-slate-200">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">Quick Actions</h3>
                    <div class="space-y-3">

                        {% if profile_status == 'Incomplete' or profile_status == 'Rejected' %}
                        <a href="/upload-invoices"
                            class="group block p-4 rounded-lg bg-emerald-100/80 border border-emerald-300 hover:border-emerald-400 hover:bg-emerald-100 transition-all">
                            <h4 class="font-semibold text-emerald-800">Complete Your Registration</h4>
                            <p class="text-sm text-emerald-600 group-hover:text-emerald-700">Finish your profile to
                                start uploading invoices.</p>
                        </a>
                        {% endif %}

                        <a href="/all-invoices"
                            class="group block p-4 rounded-lg bg-slate-100/80 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50/80 transition-all">
                            <h4 class="font-semibold text-slate-800">Track Invoices</h4>
                            <p class="text-sm text-slate-600 group-hover:text-slate-700">View the status of all your
                                submissions.</p>
                        </a>
                        <a href="/payment-history"
                            class="group block p-4 rounded-lg bg-slate-100/80 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50/80 transition-all">
                            <h4 class="font-semibold text-slate-800">View Payment History</h4>
                            <p class="text-sm text-slate-600 group-hover:text-slate-700">See a list of all successfully
                                paid invoices.</p>
                        </a>
                        <a href="/your-profile"
                            class="group block p-4 rounded-lg bg-slate-100/80 border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50/80 transition-all">
                            <h4 class="font-semibold text-slate-800">Update Bank Details</h4>
                            <p class="text-sm text-slate-600 group-hover:text-slate-700">Ensure your payment info is up
                                to date.</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}